import{r as h}from"./vendor-BsBmf7g_.js";import{u as i}from"./useMutation-DkpW_JRO.js";import{u as f,s as r}from"./index-BYGJTMIk.js";function g(){const{toast:a}=f(),[p,d]=h.useState(null),l=i({mutationFn:async e=>{const{data:t,error:o}=await r.from("palestra_leads").insert({nome:e.nome,email:e.email,telefone:e.telefone}).select("id").single();if(o)throw o;if(!t)throw new Error("Erro ao criar lead");return t.id},onSuccess:e=>{d(e),a({title:"Dados salvos!",description:"Suas informações foram registradas com sucesso."})},onError:e=>{console.error("Erro ao criar lead:",e),a({title:"Erro ao salvar dados",description:e instanceof Error?e.message:"Tente novamente mais tarde.",variant:"destructive"})}}),c=i({mutationFn:async({leadId:e,gatilho:t,leadData:o})=>{const{error:s}=await r.from("palestra_leads").update({gatilho:t,webhook_sent:!0,webhook_sent_at:new Date().toISOString()}).eq("id",e);if(s)throw s;const n={nome:o.nome,telefone:o.telefone,email:o.email,gatilho:t},u=await fetch("https://webhook.aiensed.com/webhook/capturaotto",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});u.ok||(console.error("Erro ao enviar webhook:",u.status),await r.from("palestra_leads").update({webhook_sent:!1,webhook_sent_at:null}).eq("id",e))},onSuccess:()=>{a({title:"Interesse registrado!",description:"Entraremos em contato em breve."})},onError:e=>{console.error("Erro ao processar gatilho:",e),a({title:"Erro ao processar",description:"Seus dados foram salvos, mas tivemos um problema ao enviar. Tente novamente.",variant:"destructive"})}}),m=i({mutationFn:async e=>{const{data:t,error:o}=await r.from("palestra_leads").insert({nome:e.nome,email:e.email,telefone:e.telefone,gatilho:e.gatilho,webhook_sent:!0,webhook_sent_at:new Date().toISOString()}).select("id").single();if(o)throw o;const s={nome:e.nome,telefone:e.telefone,email:e.email,gatilho:e.gatilho||""},n=await fetch("https://webhook.aiensed.com/webhook/capturaotto",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});n.ok||(console.error("Erro ao enviar webhook:",n.status),t&&await r.from("palestra_leads").update({webhook_sent:!1,webhook_sent_at:null}).eq("id",t.id))},onSuccess:()=>{a({title:"Cadastro realizado!",description:"Entraremos em contato em breve."})},onError:e=>{console.error("Erro ao criar lead:",e),a({title:"Erro ao salvar dados",description:e instanceof Error?e.message:"Tente novamente mais tarde.",variant:"destructive"})}});return{leadId:p,setLeadId:d,createLead:l.mutate,updateLeadAndSendWebhook:c.mutate,createLeadAndSendWebhook:m.mutate,isCreating:l.isPending,isUpdating:c.isPending,isProcessing:m.isPending}}export{g as u};
