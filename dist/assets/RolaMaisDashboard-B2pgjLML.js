import{j as e}from"./ui-B2Y7o2X1.js";import{r as b}from"./vendor-BsBmf7g_.js";import{b as A,s as q,C as m,c as y,d as M,e as T,f as x,B as g,a as E,u as V,T as S,p as R,q as D}from"./index-BYGJTMIk.js";import{u as U}from"./useQuery-CdAOd0lP.js";import{Z as k,Q as B,f as P,n as I,c as L,j as H,C as G,R as z,u as O,a as _,D as Z,S as Q,P as W,s as K}from"./icons-BPYBiv7x.js";import{S as j}from"./skeleton-BPQa0ql-.js";import{E as J}from"./jspdf.es.min-DVlhy0Qz.js";import X from"./html2canvas.esm-CBrSDip1.js";import{u as Y}from"./router-Bs1VKYaT.js";import"./utils-CftW5NT4.js";const F=[{id:"rolamais-main",name:"RolaMais",description:"RolaMais Principal",key:"RolaMais"}];function ee(t,o){const{user:a}=A();return U({queryKey:["rolamais-branch-data",t,o==null?void 0:o.toISOString().split("T")[0]],queryFn:async()=>{if(!a)throw new Error("Usu√°rio n√£o autenticado");const l=F.find(c=>c.id===t);if(!l)throw new Error("Filial n√£o encontrada");console.log("Buscando dados para filial RolaMais:",l.key);let d=q.from("html_RolaMais").select("*").eq("atendente",l.key).order("data",{ascending:!1}).limit(1);if(o){const c=new Date(o);c.setHours(0,0,0,0);const h=new Date(o);h.setHours(23,59,59,999),d=d.gte("data",c.toISOString()).lte("data",h.toISOString())}const{data:r,error:s}=await d.single();if(console.log("Resultado da query RolaMais:",{data:r,error:s}),s&&s.code!=="PGRST116")throw console.error("Erro na query RolaMais:",s),s;return r},enabled:!!a&&!!t,staleTime:2*60*1e3,refetchOnWindowFocus:!1,retry:1})}const se=t=>{switch(t){case"rolamais-main":return e.jsx(k,{className:"h-5 w-5"});default:return e.jsx(H,{className:"h-5 w-5"})}},ae=t=>{switch(t){case"rolamais-main":return"from-orange-500 to-red-600";default:return"from-gray-500 to-gray-600"}},re=t=>t.includes("main")?{type:"Principal",color:"bg-orange-100 text-orange-800"}:{type:"Filial",color:"bg-gray-100 text-gray-800"};function te({selectedBranch:t,onBranchSelect:o,onDateSelect:a,selectedDate:l}){const d=r=>{const s=r.target.value?new Date(r.target.value):null;a(s)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"inline-flex items-center justify-center mb-4",children:e.jsx("div",{className:"h-16 w-16 bg-gradient-to-r from-orange-500 to-red-600 rounded-xl flex items-center justify-center",children:e.jsx(k,{className:"h-8 w-8 text-white"})})}),e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-orange-600 to-red-600 bg-clip-text text-transparent",children:"Dashboard RolaMais"}),e.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:"Selecione uma filial para visualizar o relat√≥rio espec√≠fico"})]}),e.jsxs(m,{className:"border-border/50 bg-card/50 backdrop-blur-sm",children:[e.jsxs(y,{className:"pb-3",children:[e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-5 w-5 text-primary"}),"Filtro por Data"]}),e.jsx(T,{children:"Selecione uma data espec√≠fica para filtrar os relat√≥rios"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"date",value:l?l.toISOString().split("T")[0]:"",onChange:d,className:"w-full px-3 py-2 border border-border rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary/20"})}),l&&e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>a(null),className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),"Limpar Filtro"]})]}),l&&e.jsx("div",{className:"mt-3 p-3 bg-orange-50 dark:bg-orange-950/20 rounded-lg border border-orange-200 dark:border-orange-800/50",children:e.jsxs("p",{className:"text-sm text-orange-700 dark:text-orange-300 font-medium",children:["üìÖ Filtrando relat√≥rios de: ",l.toLocaleDateString("pt-BR")]})})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:F.map(r=>{const s=t===r.id,c=re(r.id);return e.jsxs(m,{className:`cursor-pointer transition-all duration-300 hover:shadow-lg border-border/50 bg-card/50 backdrop-blur-sm ${s?"ring-2 ring-orange-500 shadow-lg scale-105":"hover:scale-102"}`,onClick:()=>o(r.id),children:[e.jsxs(y,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`p-2 rounded-lg bg-gradient-to-r ${ae(r.id)} text-white`,children:se(r.id)}),e.jsx(E,{className:c.color,children:c.type})]}),e.jsx(M,{className:"text-lg font-semibold",children:r.name}),e.jsx(T,{className:"text-sm",children:r.description})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(I,{className:"h-3 w-3"}),e.jsx("span",{children:"RolaMais"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(L,{className:"h-3 w-3"}),e.jsx("span",{children:"Relat√≥rio Principal"})]})]}),s&&e.jsx("div",{className:"mt-4 p-3 bg-orange-50 dark:bg-orange-950/20 rounded-lg border border-orange-200 dark:border-orange-800/50",children:e.jsxs("p",{className:"text-sm text-orange-700 dark:text-orange-300 font-medium flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full animate-pulse"}),"Selecionado"]})})]})]},r.id)})}),e.jsx(m,{className:"border-border/50 bg-card/50 backdrop-blur-sm",children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"text-center space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-muted-foreground",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),e.jsx("span",{className:"text-sm font-medium",children:"Como usar:"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-orange-100 dark:bg-orange-900/50 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-orange-600 dark:text-orange-400",children:"1"})}),e.jsx("span",{children:"Selecione a filial RolaMais"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-orange-100 dark:bg-orange-900/50 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-orange-600 dark:text-orange-400",children:"2"})}),e.jsx("span",{children:"Escolha uma data (opcional)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-orange-100 dark:bg-orange-900/50 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-orange-600 dark:text-orange-400",children:"3"})}),e.jsx("span",{children:"Visualize o relat√≥rio"})]})]})]})})})]})}function ie({selectedBranch:t,selectedDate:o}){const{data:a,isLoading:l,error:d,refetch:r}=ee(t,o),s=F.find(i=>i.id===t),c=i=>new Date(i).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),h=async()=>{if(a!=null&&a.html)try{const i=document.createElement("div");i.innerHTML=a.html,i.style.position="absolute",i.style.left="-9999px",i.style.top="-9999px",i.style.width="210mm",i.style.backgroundColor="white",i.style.padding="20px",document.body.appendChild(i);const f=await X(i,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff"});document.body.removeChild(i);const v=f.toDataURL("image/png"),u=new J("p","mm","a4"),N=210,w=295,p=f.height*N/f.width;let n=p,C=0;for(u.addImage(v,"PNG",0,C,N,p),n-=w;n>=0;)C=n-p,u.addPage(),u.addImage(v,"PNG",0,C,N,p),n-=w;const $=`${(s==null?void 0:s.name)||"relatorio-rolamais"}_${a.data.split("T")[0]}.pdf`;u.save($)}catch(i){console.error("Erro ao gerar PDF:",i),alert("Erro ao gerar PDF. Tente novamente.")}};return l?e.jsxs(m,{className:"border-border/50 bg-card/50 backdrop-blur-sm",children:[e.jsx(y,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j,{className:"h-8 w-8 rounded-lg"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{className:"h-6 w-48"}),e.jsx(j,{className:"h-4 w-32"})]})]})}),e.jsxs(x,{className:"space-y-4",children:[e.jsx(j,{className:"h-4 w-full"}),e.jsx(j,{className:"h-4 w-3/4"}),e.jsx(j,{className:"h-96 w-full rounded-lg"})]})]}):d?e.jsx(m,{className:"border-border/50 bg-card/50 backdrop-blur-sm",children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"h-16 w-16 bg-destructive/10 rounded-full flex items-center justify-center mx-auto",children:e.jsx(G,{className:"h-8 w-8 text-destructive"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Erro ao carregar relat√≥rio"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"N√£o foi poss√≠vel carregar o relat√≥rio do RolaMais."}),e.jsxs(g,{onClick:()=>r(),className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"Tentar novamente"]})]})]})})}):a?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(m,{className:"border-border/50 bg-card/50 backdrop-blur-sm",children:[e.jsx(y,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-900/50 rounded-lg",children:e.jsx(O,{className:"h-5 w-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx(M,{className:"text-xl",children:s==null?void 0:s.description}),e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4"}),s==null?void 0:s.name]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(E,{variant:"outline",className:"flex items-center gap-1 border-orange-200 text-orange-700",children:[e.jsx(_,{className:"h-3 w-3 text-green-500"}),"Dispon√≠vel"]})})]})}),e.jsx(x,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(B,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Data do Relat√≥rio:"}),e.jsx("span",{children:c(a.data)})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(P,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"ID:"}),e.jsx("span",{className:"font-mono text-xs",children:a.id})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(H,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Filial:"}),e.jsx("span",{children:s==null?void 0:s.description})]})]})})]}),e.jsx(m,{className:"border-border/50 bg-card/50 backdrop-blur-sm",children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(g,{onClick:h,className:"flex items-center gap-2 bg-orange-600 hover:bg-orange-700",children:[e.jsx(Z,{className:"h-4 w-4"}),"Baixar PDF"]}),e.jsxs(g,{variant:"outline",onClick:()=>r(),className:"flex items-center gap-2 border-orange-200 text-orange-700 hover:bg-orange-50",children:[e.jsx(z,{className:"h-4 w-4"}),"Atualizar"]})]})})}),e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"w-full min-h-screen bg-white",dangerouslySetInnerHTML:{__html:a.html}})})]}):e.jsx(m,{className:"border-border/50 bg-card/50 backdrop-blur-sm",children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"h-16 w-16 bg-muted/50 rounded-full flex items-center justify-center mx-auto",children:e.jsx(O,{className:"h-8 w-8 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Nenhum relat√≥rio encontrado"}),e.jsx("p",{className:"text-muted-foreground",children:o?`N√£o h√° relat√≥rios dispon√≠veis para ${s==null?void 0:s.description} na data ${o.toLocaleDateString("pt-BR")}.`:`N√£o h√° relat√≥rios dispon√≠veis para ${s==null?void 0:s.description}.`})]})]})})})}const le="bdc06188-645d-4a2d-91cc-a02e44dea18b";function je(){const{user:t,signOut:o}=A(),{toast:a}=V(),l=Y(),[d,r]=b.useState(""),[s,c]=b.useState(null),[h,i]=b.useState(!1),[f,v]=b.useState(!0);b.useEffect(()=>{if(t){const n=t.id===le;i(n),v(!1),n||(a({title:"Acesso Negado",description:"Voc√™ n√£o tem permiss√£o para acessar esta p√°gina.",variant:"destructive"}),l("/dashboard"))}},[t,l,a]);const u=n=>{r(n),a({title:"Filial Selecionada",description:"Visualizando relat√≥rio do RolaMais"})},N=n=>{c(n),a(n?{title:"Filtro Aplicado",description:`Filtrando relat√≥rios de ${n.toLocaleDateString("pt-BR")}`}:{title:"Filtro Removido",description:"Exibindo todos os relat√≥rios dispon√≠veis"})},w=async()=>{const{error:n}=await o();n?a({title:"Erro ao sair",description:n.message,variant:"destructive"}):l("/auth")},p=()=>{a({title:"Dados atualizados",description:"Os dados foram atualizados com sucesso."})};return f?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800 flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"Verificando permiss√µes..."})]})}):h?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800",children:[e.jsx("header",{className:"border-b border-border/50 bg-background/80 backdrop-blur-xl supports-[backdrop-filter]:bg-background/60 sticky top-0 z-50",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>l("/"),className:"p-0 h-auto hover:bg-transparent group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-8 w-8 bg-gradient-to-r from-orange-500 to-red-600 rounded-lg flex items-center justify-center group-hover:scale-105 transition-transform duration-200",children:e.jsx(k,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xl font-bold bg-gradient-to-r from-orange-600 to-red-600 bg-clip-text text-transparent group-hover:from-orange-500 group-hover:to-red-500 transition-all duration-200",children:"RolaMais"}),e.jsx("div",{className:"text-xs text-muted-foreground group-hover:text-muted-foreground/80 transition-colors duration-200",children:"Dashboard Personalizado"})]})]})})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-orange-50 dark:bg-orange-950/20 rounded-lg border border-orange-200 dark:border-orange-800/50",children:[e.jsx(_,{className:"h-4 w-4 text-orange-600 dark:text-orange-400"}),e.jsx("span",{className:"text-sm font-medium text-orange-700 dark:text-orange-300",children:"Acesso Autorizado"})]}),e.jsxs(S,{children:[e.jsx(R,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>p(),className:"h-8 w-8 p-0 hover:bg-muted",children:e.jsx(z,{className:"h-4 w-4"})})}),e.jsx(D,{children:e.jsx("p",{children:"Atualizar dados"})})]}),e.jsxs(S,{children:[e.jsx(R,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>l("/settings"),className:"h-8 w-8 p-0 hover:bg-muted",children:e.jsx(Q,{className:"h-4 w-4"})})}),e.jsx(D,{children:e.jsx("p",{children:"Configura√ß√µes"})})]}),e.jsxs(S,{children:[e.jsx(R,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"sm",onClick:w,className:"h-8 w-8 p-0 hover:bg-muted",children:e.jsx(W,{className:"h-4 w-4"})})}),e.jsx(D,{children:e.jsx("p",{children:"Sair"})})]})]})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-8",children:[!d&&e.jsx(te,{selectedBranch:d,onBranchSelect:u,onDateSelect:N,selectedDate:s}),d&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(m,{className:"border-border/50 bg-card/50 backdrop-blur-sm",children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-900/50 rounded-lg",children:e.jsx(L,{className:"h-5 w-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Relat√≥rio Selecionado"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["RolaMais ",s&&`‚Ä¢ ${s.toLocaleDateString("pt-BR")}`]})]})]}),e.jsxs(g,{variant:"outline",onClick:()=>r(""),className:"flex items-center gap-2 border-orange-200 text-orange-700 hover:bg-orange-50",children:[e.jsx(K,{className:"h-4 w-4"}),"Voltar √† Sele√ß√£o"]})]})})}),e.jsx(ie,{selectedBranch:d,selectedDate:s})]}),e.jsx(m,{className:"border-border/50 bg-card/50 backdrop-blur-sm",children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-muted-foreground",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Informa√ß√µes Importantes:"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full mt-2"}),e.jsx("span",{children:"Os relat√≥rios s√£o atualizados automaticamente conforme novos dados s√£o inseridos"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full mt-2"}),e.jsx("span",{children:"Use o filtro de data para visualizar relat√≥rios de per√≠odos espec√≠ficos"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full mt-2"}),e.jsx("span",{children:"Voc√™ pode baixar os relat√≥rios em formato PDF para uso offline"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full mt-2"}),e.jsx("span",{children:"Esta p√°gina √© exclusiva para usu√°rios autorizados do RolaMais"})]})]})]})})})]})]}):null}export{je as default};
