import{j as e}from"./ui-B2Y7o2X1.js";import{r as t}from"./vendor-BsBmf7g_.js";import{b as H,u as J,s as U,B as o,C as m,f as x,c as W,d as B,e as K,a as Q}from"./index-BYGJTMIk.js";import{I as Y}from"./input-CJFPxKXQ.js";import{S as n}from"./skeleton-BPQa0ql-.js";import{u as $}from"./router-Bs1VKYaT.js";import{a5 as Z,a4 as V,s as X,K as D,U as A,g as v,V as F,y as ee,a6 as se,a7 as ae,R as re,a8 as te,Q as le,r as ne,S as ce}from"./icons-BPYBiv7x.js";import"./utils-CftW5NT4.js";function ge(){const{user:u}=H(),{toast:b}=J(),g=$(),[p,O]=t.useState([]),[T,E]=t.useState(!0),[L,I]=t.useState(!1),[j,R]=t.useState(""),[h,w]=t.useState("all"),[_,M]=t.useState("created_at"),[f,q]=t.useState("desc"),y=["f4c09bd2-db18-44f3-8eb9-66a50e883b67","09961117-d889-4ed7-bfcf-cac6b5e4e5a6"];t.useEffect(()=>{if(!u){g("/auth");return}if(!y.includes(u.id)){b({title:"Acesso Negado",description:"VocÃª nÃ£o tem permissÃ£o para acessar esta pÃ¡gina.",variant:"destructive"}),g("/dashboard");return}z()},[u,g]);const z=t.useCallback(async(s=!1)=>{s?I(!0):E(!0);try{await new Promise(d=>setTimeout(d,300));const a=[{id:"f4c09bd2-db18-44f3-8eb9-66a50e883b67",email:"metricasia0@gmail.com",name:"JOSE PEDRO DA SILVA FERNANDES",created_at:"2025-08-14T18:05:20.549Z",last_sign_in_at:"2025-08-14T18:05:20.549Z",whatsapp_instances:[]},{id:"09961117-d889-4ed7-bfcf-cac6b5e4e5a6",email:"carlos@example.com",name:"Carlos",created_at:"2025-08-14T21:36:33.063Z",last_sign_in_at:"2025-08-14T21:36:33.063Z",whatsapp_instances:[]},{id:"b6558e4e-4860-466f-8c7c-1461b677401",email:"ottocursos@gmail.com",name:"Otto",created_at:"2025-08-15T00:29:44.991Z",last_sign_in_at:"2025-08-15T00:29:44.991Z",whatsapp_instances:[]},{id:"6b6baed2-7ec5-4189-94c7-ee01db677401",email:"yurilucardo@gmail.com",name:"Yuri LuÃ§ardo",created_at:"2025-08-17T16:15:52.928Z",last_sign_in_at:"2025-08-17T16:15:52.928Z",whatsapp_instances:[]}];let l=[],r=null;try{const{data:d,error:N}=await U.from("whatsapp_instances").select("*").eq("is_active",!0);if(N){console.warn("Erro ao buscar todas as instÃ¢ncias:",N);const{data:c,error:S}=await U.from("whatsapp_instances").select("*").eq("user_id",u.id).eq("is_active",!0);S?(console.error("Erro ao buscar instÃ¢ncias do usuÃ¡rio:",S),r=S):l=c||[]}else l=d||[]}catch(d){console.error("Erro inesperado ao buscar instÃ¢ncias:",d),r=d}r&&console.error("Erro ao carregar instÃ¢ncias:",r);const i=a.map(d=>{const N=(l||[]).filter(c=>c.user_id===d.id);return{...d,whatsapp_instances:N.map(c=>({id:c.id,instance_name:c.instance_name,status:c.status,phone_number:c.phone_number,created_at:c.created_at,last_activity:c.last_activity}))}});O(i),s||b({title:"Sucesso",description:`Carregados ${i.length} usuÃ¡rios com dados reais.`,variant:"default"})}catch(a){console.error("Erro ao carregar dados:",a),b({title:"Erro",description:"Erro inesperado ao carregar dados.",variant:"destructive"})}finally{E(!1),I(!1)}},[b]),C=t.useMemo(()=>{let s=p.filter(a=>{const l=a.email.toLowerCase().includes(j.toLowerCase())||a.id.toLowerCase().includes(j.toLowerCase())||a.name&&a.name.toLowerCase().includes(j.toLowerCase()),r=h==="all"||h==="with-whatsapp"&&a.whatsapp_instances.length>0||h==="without-whatsapp"&&a.whatsapp_instances.length===0;return l&&r});return s.sort((a,l)=>{let r,i;switch(_){case"name":r=a.name||"",i=l.name||"";break;case"email":r=a.email,i=l.email;break;case"created_at":r=new Date(a.created_at).getTime(),i=new Date(l.created_at).getTime();break;default:r=new Date(a.created_at).getTime(),i=new Date(l.created_at).getTime()}return f==="asc"?r>i?1:-1:r<i?1:-1}),s},[p,j,h,_,f]),P=t.useCallback(s=>{switch(s){case"connected":return e.jsx(V,{className:"h-4 w-4 text-green-500"});case"connecting":return e.jsx("div",{className:"h-4 w-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"});case"disconnected":return e.jsx(Z,{className:"h-4 w-4 text-orange-500"});default:return e.jsx(Z,{className:"h-4 w-4 text-gray-400"})}},[]),G=t.useCallback(s=>{switch(s){case"connected":return"Conectado";case"connecting":return"Conectando";case"disconnected":return"Desconectado";default:return"Desconhecido"}},[]),k=t.useCallback(s=>new Date(s).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),[]);return!u||!y.includes(u.id)?null:e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800",children:[e.jsx("header",{className:"border-b border-border/50 bg-background/80 backdrop-blur-xl supports-[backdrop-filter]:bg-background/60 sticky top-0 z-50",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs(o,{variant:"ghost",onClick:()=>g("/dashboard"),className:"text-foreground hover:bg-muted transition-all duration-300 rounded-xl px-4 py-2",children:[e.jsx(X,{className:"h-5 w-5 mr-2"}),e.jsx("span",{className:"font-medium text-sm",children:"Voltar ao Dashboard"})]})}),e.jsxs("div",{className:"text-center flex-1 max-w-2xl mx-auto",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-8 h-8 bg-gradient-to-r from-purple-500 to-purple-600 rounded-lg mb-3",children:e.jsx(D,{className:"h-5 w-5 text-white"})}),e.jsx("h1",{className:"text-2xl font-bold mb-2 text-foreground",children:"Painel Administrativo"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-xl mx-auto leading-relaxed",children:"Gerencie usuÃ¡rios e monitore instÃ¢ncias do WhatsApp"})]}),e.jsx("div",{className:"w-20"})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-8",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:T?Array.from({length:5}).map((s,a)=>e.jsx(m,{className:"border-border/50 bg-card/50 backdrop-blur-sm",children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(n,{className:"h-9 w-9 rounded-lg"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{className:"h-4 w-20"}),e.jsx(n,{className:"h-8 w-12"})]})]})})},a)):e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"border-border/50 bg-card/50 backdrop-blur-sm",children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/50 rounded-lg",children:e.jsx(A,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total de UsuÃ¡rios"}),e.jsx("p",{className:"text-2xl font-bold",children:p.length})]})]})})}),e.jsx(m,{className:"border-border/50 bg-card/50 backdrop-blur-sm",children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/50 rounded-lg",children:e.jsx(v,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Com WhatsApp"}),e.jsx("p",{className:"text-2xl font-bold",children:p.filter(s=>s.whatsapp_instances.length>0).length})]})]})})}),e.jsx(m,{className:"border-border/50 bg-card/50 backdrop-blur-sm",children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-900/50 rounded-lg",children:e.jsx(V,{className:"h-5 w-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Conectados"}),e.jsx("p",{className:"text-2xl font-bold",children:p.reduce((s,a)=>s+a.whatsapp_instances.filter(l=>l.status==="connected").length,0)})]})]})})}),e.jsx(m,{className:"border-border/50 bg-card/50 backdrop-blur-sm",children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/50 rounded-lg",children:e.jsx(F,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ativos Hoje"}),e.jsx("p",{className:"text-2xl font-bold",children:p.filter(s=>{const a=new Date().toDateString();return s.last_sign_in_at&&new Date(s.last_sign_in_at).toDateString()===a}).length})]})]})})}),e.jsx(m,{className:"border-border/50 bg-card/50 backdrop-blur-sm cursor-pointer hover:bg-card/70 transition-colors",onClick:()=>g("/admin/contact-messages"),children:e.jsxs(x,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/50 rounded-lg",children:e.jsx(v,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Mensagens de Contato"}),e.jsx("p",{className:"text-2xl font-bold",children:"Ver Mensagens"})]})]}),e.jsx("div",{className:"mt-3",children:e.jsx(o,{variant:"outline",size:"sm",className:"w-full",children:"Gerenciar Mensagens"})})]})})]})}),e.jsxs(m,{className:"border-border/50 bg-card/50 backdrop-blur-sm",children:[e.jsx(W,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5 text-primary"}),"Filtros e Busca"]})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Y,{placeholder:"Buscar por nome, email ou ID...",value:j,onChange:s=>R(s.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{variant:h==="all"?"default":"outline",size:"sm",onClick:()=>w("all"),children:"Todos"}),e.jsx(o,{variant:h==="with-whatsapp"?"default":"outline",size:"sm",onClick:()=>w("with-whatsapp"),children:"Com WhatsApp"}),e.jsx(o,{variant:h==="without-whatsapp"?"default":"outline",size:"sm",onClick:()=>w("without-whatsapp"),children:"Sem WhatsApp"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:_,onChange:s=>M(s.target.value),className:"px-3 py-2 text-sm border border-border rounded-md bg-background",children:[e.jsx("option",{value:"created_at",children:"Data de CriaÃ§Ã£o"}),e.jsx("option",{value:"name",children:"Nome"}),e.jsx("option",{value:"email",children:"Email"})]}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>q(f==="asc"?"desc":"asc"),children:f==="asc"?"â†‘":"â†“"})]}),e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>z(!0),disabled:L,children:[L?e.jsx(ae,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(re,{className:"h-4 w-4 mr-2"}),"Atualizar"]})]})]})})]}),e.jsxs(m,{className:"border-border/50 bg-card/50 backdrop-blur-sm",children:[e.jsxs(W,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5 text-primary"}),"Lista de UsuÃ¡rios"]}),e.jsxs(K,{children:[C.length," usuÃ¡rio(s) encontrado(s)"]})]}),e.jsx(x,{children:T?e.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((s,a)=>e.jsx("div",{className:"p-4 border border-border/50 rounded-lg bg-muted/20",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(n,{className:"h-8 w-8 rounded-lg"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{className:"h-4 w-48"}),e.jsx(n,{className:"h-3 w-32"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx(n,{className:"h-3 w-24"}),e.jsx(n,{className:"h-3 w-28"})]}),e.jsx(n,{className:"h-3 w-40"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{className:"h-8 w-8 rounded"}),e.jsx(n,{className:"h-8 w-8 rounded"})]})]})},a))}):C.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Nenhum usuÃ¡rio encontrado"})]}):e.jsx("div",{className:"space-y-4",children:C.map(s=>e.jsx("div",{className:"p-4 border border-border/50 rounded-lg bg-muted/20 hover:bg-muted/30 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(te,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.email}),y.includes(s.id)&&e.jsxs(Q,{variant:"default",className:"bg-purple-500 hover:bg-purple-600",children:[e.jsx(D,{className:"h-3 w-3 mr-1"}),"Admin"]})]}),s.name&&e.jsx("div",{className:"text-sm text-foreground font-medium",children:s.name}),e.jsxs("div",{className:"text-xs text-muted-foreground font-mono",children:["ID: ",s.id]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"h-3 w-3"}),e.jsxs("span",{children:["Criado: ",k(s.created_at)]})]}),s.last_sign_in_at&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(F,{className:"h-3 w-3"}),e.jsxs("span",{children:["Ãšltimo acesso: ",k(s.last_sign_in_at)]})]})]}),s.whatsapp_instances.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-muted-foreground",children:[e.jsx(v,{className:"h-4 w-4"}),"InstÃ¢ncias do WhatsApp (",s.whatsapp_instances.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:s.whatsapp_instances.map(a=>e.jsxs("div",{className:"p-3 bg-background/50 rounded-lg border border-border/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-sm",children:a.instance_name}),e.jsxs("div",{className:"flex items-center gap-1",children:[P(a.status),e.jsx("span",{className:"text-xs text-muted-foreground",children:G(a.status)})]})]}),a.phone_number&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["ðŸ“± ",a.phone_number]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Criado: ",k(a.created_at)]})]},a.id))})]}):e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(v,{className:"h-4 w-4"}),e.jsx("span",{children:"Nenhuma instÃ¢ncia do WhatsApp conectada"})]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsx(o,{variant:"outline",size:"sm",children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"sm",children:e.jsx(ce,{className:"h-4 w-4"})})]})]})},s.id))})})]})]})]})}export{ge as default};
