import{j as e}from"./ui-B2Y7o2X1.js";import{r as b}from"./vendor-BsBmf7g_.js";import{b as E,s as $,C as m,c as w,d as D,e as z,f as x,B as u,a as L,u as U,T as C,p as T,q as R}from"./index-BYGJTMIk.js";import{u as q}from"./useQuery-CdAOd0lP.js";import{Q as M,f as P,n as _,c as F,j as S,U as G,T as I,C as Q,R as B,u as A,a as V,D as W,S as K,P as Z,s as J}from"./icons-BPYBiv7x.js";import{S as j}from"./skeleton-BPQa0ql-.js";import{E as X}from"./jspdf.es.min-DVlhy0Qz.js";import Y from"./html2canvas.esm-CBrSDip1.js";import{u as ee}from"./router-Bs1VKYaT.js";import"./utils-CftW5NT4.js";const O=[{id:"smv-planos",name:"SMVplano",description:"S√£o Miguel Viam√£o planos",key:"SMVplano"},{id:"smv-atendimento",name:"SMVatendimento",description:"S√£o Miguel Viam√£o atendimento",key:"SMVatendimento"},{id:"rost-atendimento",name:"RSTatendimento",description:"Rost atendimento",key:"RSTatendimento"},{id:"rost-planos",name:"RSTplanos",description:"Rost planos",key:"RSTplanos"}];function se(t,o){const{user:a}=E();return q({queryKey:["branch-data",t,o==null?void 0:o.toISOString().split("T")[0]],queryFn:async()=>{if(!a)throw new Error("Usu√°rio n√£o autenticado");const l=O.find(c=>c.id===t);if(!l)throw new Error("Filial n√£o encontrada");console.log("Buscando dados para filial:",l.key);let d=$.from("html_S√£oMiguel").select("*").eq("atendente",l.key).order("data",{ascending:!1}).limit(1);if(o){const c=new Date(o);c.setHours(0,0,0,0);const p=new Date(o);p.setHours(23,59,59,999),d=d.gte("data",c.toISOString()).lte("data",p.toISOString())}const{data:r,error:s}=await d.single();if(console.log("Resultado da query:",{data:r,error:s}),s&&s.code!=="PGRST116")throw console.error("Erro na query:",s),s;return r},enabled:!!a&&!!t,staleTime:2*60*1e3,refetchOnWindowFocus:!1,retry:1})}const ae=t=>{switch(t){case"smv-planos":case"rost-planos":return e.jsx(I,{className:"h-5 w-5"});case"smv-atendimento":case"smpoa-atendimento":case"rost-atendimento":return e.jsx(G,{className:"h-5 w-5"});default:return e.jsx(S,{className:"h-5 w-5"})}},re=t=>{switch(t){case"smv-planos":return"from-blue-500 to-blue-600";case"smv-atendimento":return"from-emerald-500 to-emerald-600";case"smpoa-atendimento":return"from-purple-500 to-purple-600";case"rost-atendimento":return"from-orange-500 to-orange-600";case"rost-planos":return"from-indigo-500 to-indigo-600";default:return"from-gray-500 to-gray-600"}},te=t=>t.includes("planos")?{type:"Planos",color:"bg-blue-100 text-blue-800"}:{type:"Atendimento",color:"bg-green-100 text-green-800"};function ie({selectedBranch:t,onBranchSelect:o,onDateSelect:a,selectedDate:l}){const d=r=>{const s=r.target.value?new Date(r.target.value):null;a(s)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"inline-flex items-center justify-center mb-4",children:e.jsx("img",{src:"/LOGO S√ÉO MIGUEL.svg",alt:"S√£o Miguel Logo",className:"h-16 w-auto"})}),e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-foreground to-foreground/80 bg-clip-text text-transparent",children:"Dashboard S√£o Miguel"}),e.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:"Selecione uma filial para visualizar o relat√≥rio espec√≠fico"})]}),e.jsxs(m,{className:"border-border/50 bg-card/50 backdrop-blur-sm",children:[e.jsxs(w,{className:"pb-3",children:[e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5 text-primary"}),"Filtro por Data"]}),e.jsx(z,{children:"Selecione uma data espec√≠fica para filtrar os relat√≥rios"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"date",value:l?l.toISOString().split("T")[0]:"",onChange:d,className:"w-full px-3 py-2 border border-border rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary/20"})}),l&&e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>a(null),className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),"Limpar Filtro"]})]}),l&&e.jsx("div",{className:"mt-3 p-3 bg-primary/10 rounded-lg border border-primary/20",children:e.jsxs("p",{className:"text-sm text-primary font-medium",children:["üìÖ Filtrando relat√≥rios de: ",l.toLocaleDateString("pt-BR")]})})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:O.map(r=>{const s=t===r.id,c=te(r.id);return e.jsxs(m,{className:`cursor-pointer transition-all duration-300 hover:shadow-lg border-border/50 bg-card/50 backdrop-blur-sm ${s?"ring-2 ring-primary shadow-lg scale-105":"hover:scale-102"}`,onClick:()=>o(r.id),children:[e.jsxs(w,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`p-2 rounded-lg bg-gradient-to-r ${re(r.id)} text-white`,children:ae(r.id)}),e.jsx(L,{className:c.color,children:c.type})]}),e.jsx(D,{className:"text-lg font-semibold",children:r.name}),e.jsx(z,{className:"text-sm",children:r.description})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(_,{className:"h-3 w-3"}),e.jsx("span",{children:r.description.includes("Viam√£o")?"S√£o Miguel Viam√£o":r.description.includes("Porto Alegre")?"S√£o Miguel Porto Alegre":"Rost"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(F,{className:"h-3 w-3"}),e.jsx("span",{children:c.type==="Planos"?"Relat√≥rio de Planos":"Relat√≥rio de Atendimento"})]})]}),s&&e.jsx("div",{className:"mt-4 p-3 bg-primary/10 rounded-lg border border-primary/20",children:e.jsxs("p",{className:"text-sm text-primary font-medium flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-pulse"}),"Selecionado"]})})]})]},r.id)})}),e.jsx(m,{className:"border-border/50 bg-card/50 backdrop-blur-sm",children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"text-center space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-muted-foreground",children:[e.jsx("div",{className:"w-2 h-2 bg-primary rounded-full"}),e.jsx("span",{className:"text-sm font-medium",children:"Como usar:"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-primary",children:"1"})}),e.jsx("span",{children:"Selecione uma filial"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-primary",children:"2"})}),e.jsx("span",{children:"Escolha uma data (opcional)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-primary",children:"3"})}),e.jsx("span",{children:"Visualize o relat√≥rio"})]})]})]})})})]})}function le({selectedBranch:t,selectedDate:o}){const{data:a,isLoading:l,error:d,refetch:r}=se(t,o),s=O.find(i=>i.id===t),c=i=>new Date(i).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),p=async()=>{if(a!=null&&a.html)try{const i=document.createElement("div");i.innerHTML=a.html,i.style.position="absolute",i.style.left="-9999px",i.style.top="-9999px",i.style.width="210mm",i.style.backgroundColor="white",i.style.padding="20px",document.body.appendChild(i);const f=await Y(i,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff"});document.body.removeChild(i);const v=f.toDataURL("image/png"),h=new X("p","mm","a4"),N=210,y=295,g=f.height*N/f.width;let n=g,k=0;for(h.addImage(v,"PNG",0,k,N,g),n-=y;n>=0;)k=n-g,h.addPage(),h.addImage(v,"PNG",0,k,N,g),n-=y;const H=`${(s==null?void 0:s.name)||"relatorio"}_${a.data.split("T")[0]}.pdf`;h.save(H)}catch(i){console.error("Erro ao gerar PDF:",i),alert("Erro ao gerar PDF. Tente novamente.")}};return l?e.jsxs(m,{className:"border-border/50 bg-card/50 backdrop-blur-sm",children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j,{className:"h-8 w-8 rounded-lg"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{className:"h-6 w-48"}),e.jsx(j,{className:"h-4 w-32"})]})]})}),e.jsxs(x,{className:"space-y-4",children:[e.jsx(j,{className:"h-4 w-full"}),e.jsx(j,{className:"h-4 w-3/4"}),e.jsx(j,{className:"h-96 w-full rounded-lg"})]})]}):d?e.jsx(m,{className:"border-border/50 bg-card/50 backdrop-blur-sm",children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"h-16 w-16 bg-destructive/10 rounded-full flex items-center justify-center mx-auto",children:e.jsx(Q,{className:"h-8 w-8 text-destructive"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Erro ao carregar relat√≥rio"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"N√£o foi poss√≠vel carregar o relat√≥rio da filial selecionada."}),e.jsxs(u,{onClick:()=>r(),className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4"}),"Tentar novamente"]})]})]})})}):a?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(m,{className:"border-border/50 bg-card/50 backdrop-blur-sm",children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(A,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx(D,{className:"text-xl",children:s==null?void 0:s.description}),e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4"}),s==null?void 0:s.name]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(L,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(V,{className:"h-3 w-3 text-green-500"}),"Dispon√≠vel"]})})]})}),e.jsx(x,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(M,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Data do Relat√≥rio:"}),e.jsx("span",{children:c(a.data)})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(P,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"ID:"}),e.jsx("span",{className:"font-mono text-xs",children:a.id})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(S,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Filial:"}),e.jsx("span",{children:s==null?void 0:s.description})]})]})})]}),e.jsx(m,{className:"border-border/50 bg-card/50 backdrop-blur-sm",children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(u,{onClick:p,className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),"Baixar PDF"]}),e.jsxs(u,{variant:"outline",onClick:()=>r(),className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4"}),"Atualizar"]})]})})}),e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"w-full min-h-screen bg-white",dangerouslySetInnerHTML:{__html:a.html}})})]}):e.jsx(m,{className:"border-border/50 bg-card/50 backdrop-blur-sm",children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"h-16 w-16 bg-muted/50 rounded-full flex items-center justify-center mx-auto",children:e.jsx(A,{className:"h-8 w-8 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Nenhum relat√≥rio encontrado"}),e.jsx("p",{className:"text-muted-foreground",children:o?`N√£o h√° relat√≥rios dispon√≠veis para ${s==null?void 0:s.description} na data ${o.toLocaleDateString("pt-BR")}.`:`N√£o h√° relat√≥rios dispon√≠veis para ${s==null?void 0:s.description}.`})]})]})})})}const ne="1c93324c-65d3-456e-992e-c84e1f7d6ab1";function fe(){const{user:t,signOut:o}=E(),{toast:a}=U(),l=ee(),[d,r]=b.useState(""),[s,c]=b.useState(null),[p,i]=b.useState(!1),[f,v]=b.useState(!0);b.useEffect(()=>{if(t){const n=t.id===ne;i(n),v(!1),n||(a({title:"Acesso Negado",description:"Voc√™ n√£o tem permiss√£o para acessar esta p√°gina.",variant:"destructive"}),l("/dashboard"))}},[t,l,a]);const h=n=>{r(n),a({title:"Filial Selecionada",description:`Visualizando relat√≥rio de ${n}`})},N=n=>{c(n),a(n?{title:"Filtro Aplicado",description:`Filtrando relat√≥rios de ${n.toLocaleDateString("pt-BR")}`}:{title:"Filtro Removido",description:"Exibindo todos os relat√≥rios dispon√≠veis"})},y=async()=>{const{error:n}=await o();n?a({title:"Erro ao sair",description:n.message,variant:"destructive"}):l("/auth")},g=()=>{a({title:"Dados atualizados",description:"Os dados foram atualizados com sucesso."})};return f?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800 flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"Verificando permiss√µes..."})]})}):p?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800",children:[e.jsx("header",{className:"border-b border-border/50 bg-background/80 backdrop-blur-xl supports-[backdrop-filter]:bg-background/60 sticky top-0 z-50",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>l("/"),className:"p-0 h-auto hover:bg-transparent group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-8 w-8 bg-gradient-to-r from-primary to-primary/80 rounded-lg flex items-center justify-center group-hover:scale-105 transition-transform duration-200",children:e.jsx(S,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xl font-bold bg-gradient-to-r from-primary to-primary/80 bg-clip-text text-transparent group-hover:from-primary/80 group-hover:to-primary/60 transition-all duration-200",children:"S√£o Miguel"}),e.jsx("div",{className:"text-xs text-muted-foreground group-hover:text-muted-foreground/80 transition-colors duration-200",children:"Dashboard Personalizado"})]})]})})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-green-50 dark:bg-green-950/20 rounded-lg border border-green-200 dark:border-green-800/50",children:[e.jsx(V,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-green-700 dark:text-green-300",children:"Acesso Autorizado"})]}),e.jsxs(C,{children:[e.jsx(T,{asChild:!0,children:e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>g(),className:"h-8 w-8 p-0 hover:bg-muted",children:e.jsx(B,{className:"h-4 w-4"})})}),e.jsx(R,{children:e.jsx("p",{children:"Atualizar dados"})})]}),e.jsxs(C,{children:[e.jsx(T,{asChild:!0,children:e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>l("/settings"),className:"h-8 w-8 p-0 hover:bg-muted",children:e.jsx(K,{className:"h-4 w-4"})})}),e.jsx(R,{children:e.jsx("p",{children:"Configura√ß√µes"})})]}),e.jsxs(C,{children:[e.jsx(T,{asChild:!0,children:e.jsx(u,{variant:"ghost",size:"sm",onClick:y,className:"h-8 w-8 p-0 hover:bg-muted",children:e.jsx(Z,{className:"h-4 w-4"})})}),e.jsx(R,{children:e.jsx("p",{children:"Sair"})})]})]})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-8",children:[!d&&e.jsx(ie,{selectedBranch:d,onBranchSelect:h,onDateSelect:N,selectedDate:s}),d&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(m,{className:"border-border/50 bg-card/50 backdrop-blur-sm",children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(F,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Relat√≥rio Selecionado"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[d," ",s&&`‚Ä¢ ${s.toLocaleDateString("pt-BR")}`]})]})]}),e.jsxs(u,{variant:"outline",onClick:()=>r(""),className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4"}),"Voltar √† Sele√ß√£o"]})]})})}),e.jsx(le,{selectedBranch:d,selectedDate:s})]}),e.jsx(m,{className:"border-border/50 bg-card/50 backdrop-blur-sm",children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-muted-foreground",children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Informa√ß√µes Importantes:"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2"}),e.jsx("span",{children:"Os relat√≥rios s√£o atualizados automaticamente conforme novos dados s√£o inseridos"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2"}),e.jsx("span",{children:"Use o filtro de data para visualizar relat√≥rios de per√≠odos espec√≠ficos"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2"}),e.jsx("span",{children:"Voc√™ pode baixar os relat√≥rios em formato HTML para uso offline"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2"}),e.jsx("span",{children:"Esta p√°gina √© exclusiva para usu√°rios autorizados"})]})]})]})})})]})]}):null}export{fe as default};
